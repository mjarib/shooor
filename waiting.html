<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بانتظار الموافقة | شـــووور</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>body { font-family: 'Tajawal', sans-serif; }</style>
</head>
<body class="bg-slate-50 flex items-center justify-center min-h-screen p-6">

    <div class="max-w-md w-full bg-white p-10 rounded-[3rem] shadow-xl text-center border border-slate-100">
        <div class="w-20 h-20 border-4 border-blue-900 border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
        <h2 class="text-2xl font-black text-blue-900 mb-4 italic">جاري طلب الشور...</h2>
        <p class="text-slate-500 font-bold text-sm mb-8 leading-relaxed">
            لقد أرسلنا طلبك للخبير <span id="expert-name" class="text-orange-500">...</span>. يرجى الانتظار قليلاً ليقوم بقبول الجلسة والبدء بالدردشة.
        </p>
        <div class="p-4 bg-blue-50 rounded-2xl border border-blue-100 mb-6">
            <p class="text-[10px] text-blue-400 font-black uppercase tracking-widest mb-1">حالة الطلب</p>
            <p id="status-text" class="text-sm font-black text-blue-900">بانتظار رد الخبير...</p>
        </div>
        <button onclick="window.location.href='index.html'" class="text-[10px] text-slate-400 font-black uppercase tracking-widest underline">إلغاء والعودة للرئيسية</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAZSFCf7piwKykf_klgGlzc4RkCXumNRUg",
            authDomain: "shooor-app.firebaseapp.com",
            projectId: "shooor-app",
            storageBucket: "shooor-app.firebasestorage.app",
            messagingSenderId: "356426973132",
            appId: "1:356426973132:web:6353917bf13a64074d6769"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const params = new URLSearchParams(window.location.search);
        const requestId = params.get('requestId');
        const expert = params.get('expert');

        if (expert) document.getElementById('expert-name').innerText = expert;

        if (requestId) {
            db.collection("consultations").doc(requestId).onSnapshot((doc) => {
                if (doc.exists) {
                    const status = doc.data().status;
                    if (status === 'approved') {
                        document.getElementById('status-text').innerText = "تم القبول! جاري التحويل...";
                        setTimeout(() => {
                            window.location.href = `chat.html?expert=${encodeURIComponent(expert)}&requestId=${requestId}`;
                        }, 1000);
                    } else if (status === 'rejected') {
                        alert("عذراً، اعتذر الخبير عن قبول الجلسة حالياً.");
                        window.location.href = 'index.html';
                    }
                }
            });
        }
    </script>
</body>
</html>
