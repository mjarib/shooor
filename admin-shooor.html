<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إدارة شـــووور | المركز الرئيسي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>body { font-family: 'Tajawal', sans-serif; }</style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">

    <nav class="border-b border-slate-800 p-6 flex justify-between items-center bg-slate-900 sticky top-0 z-50">
        <h1 class="text-2xl font-black italic">لوحة الإدارة المركزية</h1>
        <div class="flex gap-4">
            <span class="bg-green-500/10 text-green-500 px-4 py-1 rounded-full text-[10px] font-black border border-green-500/20 uppercase">النظام يعمل</span>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-6 grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="bg-slate-800 p-6 rounded-[2rem] border border-slate-700">
            <p class="text-slate-400 text-xs font-bold mb-1">إجمالي العمليات المدفوعة</p>
            <h2 id="total-paid" class="text-3xl font-black text-orange-500">جاري الحساب..</h2>
        </div>

        <div class="md:col-span-2 bg-white text-slate-900 p-8 rounded-[2.5rem]">
            <h3 class="font-black text-xl mb-6 flex justify-between items-center">
                الجلسات النشطة الآن
                <span class="text-[10px] bg-blue-100 px-3 py-1 rounded-full text-blue-600">بث مباشر</span>
            </h3>
            <div id="live-sessions" class="space-y-3">
                </div>
        </div>

        <div class="md:col-span-3 bg-slate-800 p-8 rounded-[2.5rem] border border-slate-700">
            <h3 class="font-black text-xl mb-6 text-white">طلبات انضمام الخبراء</h3>
            <div id="expert-apps" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                </div>
        </div>
    </main>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAZSFCf7piwKykf_klgGlzc4RkCXumNRUg",
            authDomain: "shooor-app.firebaseapp.com",
            projectId: "shooor-app",
            storageBucket: "shooor-app.firebasestorage.app",
            messagingSenderId: "356426973132",
            appId: "1:356426973132:web:6353917bf13a64074d6769"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 1. مراقبة الجلسات والمدفوعات
        db.collection("consultations").onSnapshot(snapshot => {
            let total = 0;
            const sessionDiv = document.getElementById('live-sessions');
            sessionDiv.innerHTML = '';
            
            snapshot.forEach(doc => {
                const data = doc.data();
                if(data.status === 'paid') {
                    total += 50;
                    sessionDiv.innerHTML += `
                        <div class="flex justify-between items-center p-4 bg-slate-50 rounded-2xl border">
                            <div>
                                <p class="font-black text-sm">${data.userName} ⬅️ ${data.expertName}</p>
                                <p class="text-[10px] text-green-600 font-bold italic">تم الدفع وجاري الشات</p>
                            </div>
                            <span class="text-xs font-black">50 ر.س</span>
                        </div>
                    `;
                }
            });
            document.getElementById('total-paid').innerText = total + " ر.س";
        });

        // 2. مراقبة طلبات الانضمام
        db.collection("expert_applications").orderBy("createdAt", "desc").onSnapshot(snapshot => {
            const appDiv = document.getElementById('expert-apps');
            appDiv.innerHTML = '';
            snapshot.forEach(doc => {
                const data = doc.data();
                appDiv.innerHTML += `
                    <div class="bg-slate-900 p-5 rounded-2xl border border-slate-700">
                        <p class="text-orange-500 font-black mb-1">${data.name}</p>
                        <p class="text-xs text-slate-300 mb-3">${data.category}</p>
                        <a href="https://wa.me/${data.phone}" target="_blank" class="text-[10px] bg-green-500 text-white px-3 py-1 rounded-full font-bold">تواصل واتساب</a>
                    </div>
                `;
            });
        });
    </script>
</body>
</html>
